-- Отключаем проверку внешних ключей на время выполнения миграции
SET REFERENTIAL_INTEGRITY FALSE;

-- Удаляем таблицы в обратном порядке зависимостей, если они существуют
DROP TABLE IF EXISTS profile_diagnostic_methods;
DROP TABLE IF EXISTS profile_devices;
DROP TABLE IF EXISTS diagnostic_methods;
DROP TABLE IF EXISTS devices;
DROP TABLE IF EXISTS profiles;
DROP TABLE IF EXISTS device_categories;

-- Сбрасываем последовательности
DROP SEQUENCE IF EXISTS device_categories_seq;
DROP SEQUENCE IF EXISTS devices_seq;
DROP SEQUENCE IF EXISTS diagnostic_methods_seq;
DROP SEQUENCE IF EXISTS profiles_seq;

-- Создаем последовательности для генерации ID
CREATE SEQUENCE device_categories_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE devices_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE diagnostic_methods_seq START WITH 1 INCREMENT BY 1;
CREATE SEQUENCE profiles_seq START WITH 1 INCREMENT BY 1;

-- Создаем таблицу категорий устройств
CREATE TABLE device_categories (
    id BIGINT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    gost_reference VARCHAR(255),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- Создаем таблицу профилей
CREATE TABLE profiles (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    description TEXT,
    architecture_type VARCHAR(20) NOT NULL DEFAULT 'ONE_OUT_OF_ONE',
    test_interval_days INT,
    total_diagnostic_coverage NUMERIC(5,2) DEFAULT 0.00,
    is_compliant BOOLEAN DEFAULT FALSE,
    pfd_avg DOUBLE PRECISION,
    pfd_max DOUBLE PRECISION,
    sil_level INT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    CONSTRAINT chk_architecture_type 
        CHECK (architecture_type IN ('ONE_OUT_OF_ONE', 'ONE_OUT_OF_TWO', 'TWO_OUT_OF_THREE')),
    CONSTRAINT chk_diagnostic_coverage 
        CHECK (total_diagnostic_coverage >= 0 AND total_diagnostic_coverage <= 100)
);

-- Создаем таблицу устройств
CREATE TABLE devices (
    id BIGINT PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    category_id BIGINT NOT NULL,
    channel_count INT NOT NULL DEFAULT 1,
    architecture_type VARCHAR(20) NOT NULL DEFAULT 'ONE_OUT_OF_ONE',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES device_categories(id) ON DELETE CASCADE
);

-- Создаем таблицу диагностических методов
CREATE TABLE diagnostic_methods (
    id BIGINT PRIMARY KEY,
    device_category_id BIGINT NOT NULL,
    name VARCHAR(255) NOT NULL,
    description TEXT,
    coverage_level VARCHAR(20) NOT NULL,
    coverage_percent NUMERIC(5,2) NOT NULL DEFAULT 0.0,
    diagnostic_coverage NUMERIC(5,2) NOT NULL DEFAULT 0.0,
    effectiveness VARCHAR(20) NOT NULL,
    implementation_complexity VARCHAR(20) NOT NULL,
    gost_reference VARCHAR(255), 
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (device_category_id) REFERENCES device_categories(id) ON DELETE CASCADE
);

-- Создаем связующую таблицу между профилями и устройствами
CREATE TABLE profile_devices (
    profile_id BIGINT NOT NULL,
    device_id BIGINT NOT NULL,
    PRIMARY KEY (profile_id, device_id),
    FOREIGN KEY (profile_id) REFERENCES profiles(id) ON DELETE CASCADE,
    FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE
);

-- Создаем таблицу связи устройств и диагностических методов
CREATE TABLE IF NOT EXISTS device_diagnostic_methods (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    device_id BIGINT NOT NULL,
    diagnostic_method_id BIGINT NOT NULL,
    diagnostic_coverage DOUBLE PRECISION NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE,
    FOREIGN KEY (diagnostic_method_id) REFERENCES diagnostic_methods(id) ON DELETE CASCADE,
    CONSTRAINT uk_device_diagnostic_method UNIQUE (device_id, diagnostic_method_id)
);

-- Создаем таблицу для связи профилей и диагностических методов
CREATE TABLE profile_diagnostic_methods (
    id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    profile_id BIGINT NOT NULL,
    diagnostic_method_id BIGINT NOT NULL,
    device_id BIGINT NOT NULL,
    diagnostic_coverage DOUBLE PRECISION NOT NULL,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (profile_id) REFERENCES profiles(id) ON DELETE CASCADE,
    FOREIGN KEY (diagnostic_method_id) REFERENCES diagnostic_methods(id) ON DELETE CASCADE,
    FOREIGN KEY (device_id) REFERENCES devices(id) ON DELETE CASCADE,
    UNIQUE (profile_id, diagnostic_method_id, device_id)
);

-- Начинаем транзакцию для вставки тестовых данных
BEGIN;

-- Отключаем проверку внешних ключей на время вставки
SET REFERENTIAL_INTEGRITY FALSE;

-- Вставляем категории устройств
INSERT INTO device_categories (id, name, description, gost_reference) VALUES
(1, 'Электромеханические устройства', 'Коммутационные устройства с механическим приводом (А.2)', 'ГОСТ Р МЭК 61508-2-2012 А.2'),
(2, 'Дискретные аппаратные средства', 'Электронные компоненты и каналы ввода/вывода (А.3)', 'ГОСТ Р МЭК 61508-2-2012 А.3'),
(3, 'Устройства обработки', 'Процессоры и устройства обработки данных (А.4)', 'ГОСТ Р МЭК 61508-2-2012 А.4'),
(4, 'Постоянная память', 'Энергонезависимые запоминающие устройства (А.5)', 'ГОСТ Р МЭК 61508-2-2012 А.5'),
(5, 'Устройство обработки прерываний', 'Контроллеры управления прерываниями (А.5)', 'ГОСТ Р МЭК 61508-2-2012 А.5'),
(6, 'Память с произвольным доступом', 'Динамическая память с произвольным доступом (А.6)', 'ГОСТ Р МЭК 61508-2-2012 А.6'),
(7, 'Устройства ввода/вывода', 'Интерфейсы и каналы передачи данных (А.7)', 'ГОСТ Р МЭК 61508-2-2012 А.7'),
(8, 'Информационные каналы', 'Системы передачи и обмена данными (А.8)', 'ГОСТ Р МЭК 61508-2-2012 А.8'),
(9, 'Источники питания', 'Системы электропитания (А.9)', 'ГОСТ Р МЭК 61508-2-2012 А.9'),
(10, 'Устройство синхронизации', 'Генераторы тактовой частоты (А.11)', 'ГОСТ Р МЭК 61508-2-2012 А.11'),
(11, 'Устройство связи', 'Коммуникационные модули (А.12)', 'ГОСТ Р МЭК 61508-2-2012 А.12'),
(12, 'Датчики', 'Устройства измерения физических параметров (А.13)', 'ГОСТ Р МЭК 61508-2-2012 А.13'),
(13, 'Исполнительные элементы', 'Приводы и актуаторы (А.14)', 'ГОСТ Р МЭК 61508-2-2012 А.14'),
(14, 'Шина', 'Системная шина и её компоненты', 'ГОСТ Р МЭК 61508-2-2012 А.3, А.8, А.9'),
(15, 'Процессор', 'Центральный процессор и его компоненты', 'ГОСТ Р МЭК 61508-2-2012 А.4');

-- Вставляем устройства
INSERT INTO devices (id, name, description, category_id, channel_count, architecture_type) VALUES
(1, 'Электромеханическое устройство', 'Коммутационное устройство с механическим приводом', 1, 1, 'ONE_OUT_OF_ONE'),
(2, 'Цифровой вход/выход', 'Дискретный канал ввода/вывода', 2, 2, 'ONE_OUT_OF_TWO'),
(3, 'Аналоговый вход/выход', 'Аналоговый канал ввода/вывода', 2, 2, 'ONE_OUT_OF_TWO'),
-- (4, 'Источник питания', 'Система электропитания', 9, 1, 'ONE_OUT_OF_ONE'),
(5, 'Общая шина', 'Системная шина передачи данных', 14, 2, 'ONE_OUT_OF_TWO'),
(6, 'Диспетчер памяти', 'Контроллер управления памятью', 14, 1, 'ONE_OUT_OF_ONE'),
(7, 'Прямой доступ к памяти', 'Механизм прямого обращения к памяти', 14, 2, 'ONE_OUT_OF_TWO'),
(8, 'Управление доступом к шине', 'Контроллер арбитража шины', 14, 1, 'ONE_OUT_OF_ONE'),
(9, 'Регистр процессора', 'Внутренняя память процессора', 3, 1, 'ONE_OUT_OF_ONE'),
(10, 'Внутреннее ОЗУ', 'Оперативная память процессора', 3, 2, 'ONE_OUT_OF_TWO'),
(11, 'Устройство кодирования и выполнения', 'Блок декодирования и исполнения инструкций', 3, 1, 'ONE_OUT_OF_ONE'),
(12, 'Регистр признаков', 'Регистр состояния процессора', 3, 1, 'ONE_OUT_OF_ONE'),
(13, 'Устройство вычисления адреса', 'Блок формирования адресов', 3, 1, 'ONE_OUT_OF_ONE'),
(14, 'Счетчик команд', 'Регистр последовательности выполнения инструкций', 3, 1, 'ONE_OUT_OF_ONE'),
(15, 'Указатель стека', 'Регистр управления стеком', 3, 1, 'ONE_OUT_OF_ONE'),
(16, 'Устройство прерывания', 'Контроллер управления прерываниями', 5, 2, 'ONE_OUT_OF_TWO'),
(17, 'Схема возврата', 'Механизм восстановления состояния после прерывания', 5, 1, 'ONE_OUT_OF_ONE'),
(18, 'Постоянная память', 'Энергонезависимое запоминающее устройство', 4, 1, 'ONE_OUT_OF_ONE'),
(19, 'Память с произвольным доступом', 'Динамическая память с произвольным доступом', 6, 2, 'ONE_OUT_OF_TWO'),
(20, 'Устройство синхронизации', 'Кварцевый генератор с высокой стабильностью', 10, 1, 'ONE_OUT_OF_ONE'),
(21, 'Устройство связи', 'Коммуникационный модуль передачи данных', 11, 2, 'ONE_OUT_OF_TWO'),
(22, 'Запоминающее устройство большой емкости', 'Накопитель данных с большим объемом памяти', 4, 1, 'ONE_OUT_OF_ONE'),
(23, 'Датчик', 'Устройство измерения физических параметров', 12, 2, 'ONE_OUT_OF_TWO'),
(24, 'Исполнительный элемент', 'Привод или актуатор', 13, 2, 'ONE_OUT_OF_TWO');

-- Вставляем диагностические методы
INSERT INTO diagnostic_methods (id, device_category_id, name, description, coverage_level, coverage_percent, effectiveness, implementation_complexity, gost_reference) VALUES
-- Методы для электромеханических устройств (категория 1)
(1, 1, 'Мониторинг в режиме онлайн', 'Обнаружение отказов путем непрерывного мониторинга', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.2 Таблица А.2 (А.1.1)'),
(2, 1, 'Мониторинг контактов реле', 'Контроль состояния и переключения электромеханических контактов', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.2 Таблица А.2 (Средний уровень)'),
(3, 1, 'Компаратор', 'Сравнение состояний и параметров электромеханического устройства', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.2 Таблица А.2 (А.1.3)'),
(4, 1, 'Схема голосования по мажоритарному принципу', 'Контроль работоспособности через голосование нескольких каналов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.2 Таблица А.2 (А.1.4)'),

-- Методы для дискретных аппаратных средств (категория 2)
(5, 2, 'Обнаружение отказов путем мониторинга в режиме онлайн', 'Непрерывный контроль состояния электронных компонентов', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.3 Таблица А.3 (А.1.1)'),
(6, 2, 'Компаратор', 'Сравнение параметров электронных компонентов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.3 Таблица А.3 (А.1.3)'),
(7, 2, 'Схема голосования по мажоритарному принципу', 'Контроль через голосование нескольких каналов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.3 Таблица А.3 (А.1.4)'),
(8, 2, 'Тестирование избыточным оборудованием', 'Проверка работоспособности с использованием резервных компонентов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.3 Таблица А.3 (А.2.1)'),
(9, 2, 'Принципы динамического управления', 'Динамический контроль состояния электронных компонентов', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.3 Таблица А.3 (А.2.2)'),
(10, 2, 'Стандартный тестовый порт доступа', 'Диагностика через стандартный порт', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.3 Таблица А.3 (А.2.2)'),
(11, 2, 'Избыточный контроль', 'Многоуровневый контроль электронных компонентов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.3 Таблица А.3 (А.2.3)'),
(12, 2, 'Текущий контроль аналоговых сигналов', 'Мониторинг аналоговых трактов', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.3 Таблица А.3 (А.2.7)'),

-- Методы для устройств обработки (категория 3)
(13, 3, 'Компаратор', 'Сравнение параметров устройств обработки', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.4 Таблица А.4 (А.1.3)'),
(14, 3, 'Схема голосования по мажоритарному принципу', 'Контроль через голосование нескольких каналов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.4 Таблица А.4 (А.1.4)'),
(15, 3, 'Программное самотестирование: предельное количество комбинаций', 'Тестирование через предельные комбинации', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.4 Таблица А.4 (А.3.1)'),
(16, 3, 'Программное самотестирование: блуждающий бит', 'Тестирование через перемещение битов', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.4 Таблица А.4 (А.3.2)'),
(17, 3, 'Самотестирование оборудования', 'Встроенный контроль устройств обработки', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.4 Таблица А.4 (А.3.3)'),
(18, 3, 'Запрограммированная обработка', 'Контроль через программные алгоритмы', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.4 Таблица А.4 (А.3.4)'),
(19, 3, 'Программное обнаружение несовпадений', 'Выявление расхождений в программной обработке', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.4 Таблица А.4 (А.3.5)'),

-- Методы для постоянной памяти (категория 4)
(20, 4, 'Мониторинг в режиме онлайн', 'Непрерывный контроль состояния постоянной памяти', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.5 Таблица А.5 (А.1.1)'),
(21, 4, 'Компаратор', 'Сравнение содержимого постоянной памяти', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.5 Таблица А.5 (А.1.3)'),
(22, 4, 'Контроль четности', 'Проверка целостности данных через четность', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.5 Таблица А.5 (А.2.1)'),
(23, 4, 'Контроль контрольной суммы', 'Проверка целостности данных через контрольную сумму', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.5 Таблица А.5 (А.2.2)'),
(24, 4, 'Циклический избыточный код', 'Обнаружение ошибок через CRC', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.5 Таблица А.5 (А.2.3)'),

-- Методы для устройств обработки прерываний (категория 5)
(25, 5, 'Мониторинг в режиме онлайн', 'Непрерывный контроль состояния устройства прерываний', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.5 Таблица А.5 (А.1.1)'),
(26, 5, 'Компаратор', 'Сравнение параметров устройства прерываний', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.5 Таблица А.5 (А.1.3)'),
(27, 5, 'Схема голосования по мажоритарному принципу', 'Контроль через голосование нескольких каналов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.5 Таблица А.5 (А.1.4)'),
(28, 5, 'Диагностика обработки прерываний', 'Проверка корректности механизма прерываний', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.5 Таблица А.5 (А.2.1)'),

-- Методы для памяти с произвольным доступом (категория 6)
(29, 6, 'Мониторинг в режиме онлайн', 'Непрерывный контроль состояния оперативной памяти', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.6 Таблица А.6 (А.1.1)'),
(30, 6, 'Компаратор', 'Сравнение содержимого оперативной памяти', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.6 Таблица А.6 (А.1.3)'),
(31, 6, 'Контроль четности', 'Проверка целостности данных через четность', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.6 Таблица А.6 (А.2.1)'),
(32, 6, 'Контроль контрольной суммы', 'Проверка целостности данных через контрольную сумму', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.6 Таблица А.6 (А.2.2)'),
(33, 6, 'Тестирование адресации', 'Проверка корректности адресации памяти', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.6 Таблица А.6 (А.2.3)'),

-- Методы для устройств ввода/вывода (категория 7)
(34, 7, 'Мониторинг в режиме онлайн', 'Непрерывный контроль устройств ввода/вывода', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.7 Таблица А.7 (А.1.1)'),
(35, 7, 'Компаратор', 'Сравнение параметров устройств ввода/вывода', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.7 Таблица А.7 (А.1.3)'),
(36, 7, 'Схема голосования по мажоритарному принципу', 'Контроль через голосование нескольких каналов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.7 Таблица А.7 (А.1.4)'),
(37, 7, 'Тестирование интерфейса', 'Проверка корректности обмена данными', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.7 Таблица А.7 (А.2.1)'),
(38, 7, 'Контроль протокола обмена', 'Проверка корректности протокола', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.7 Таблица А.7 (А.2.2)'),

-- Методы для информационных каналов (категория 8)
(39, 8, 'Мониторинг в режиме онлайн', 'Непрерывный контроль информационных каналов', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.8 Таблица А.8 (А.1.1)'),
(40, 8, 'Компаратор', 'Сравнение параметров информационных каналов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.8 Таблица А.8 (А.1.3)'),
(41, 8, 'Контроль целостности данных', 'Проверка корректности передачи информации', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.8 Таблица А.8 (А.2.1)'),
(42, 8, 'Контроль задержки передачи', 'Мониторинг временных характеристик канала', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.8 Таблица А.8 (А.2.2)'),

-- Методы для источников питания (категория 9)
(43, 9, 'Мониторинг напряжения', 'Непрерывный контроль уровня напряжения', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.9 Таблица А.9 (А.1.1)'),
(44, 9, 'Контроль токовой нагрузки', 'Мониторинг токовой нагрузки источника питания', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.9 Таблица А.9 (А.2.1)'),
(45, 9, 'Диагностика источника резервного питания', 'Проверка работоспособности резервного источника', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.9 Таблица А.9 (А.2.2)'),
(46, 9, 'Контроль температурного режима', 'Мониторинг температуры источника питания', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.9 Таблица А.9 (А.2.3)'),

-- Методы для устройств синхронизации (категория 10)
(47, 10, 'Мониторинг тактовой частоты', 'Непрерывный контроль стабильности частоты', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.11 Таблица А.11 (А.1.1)'),
(48, 10, 'Компаратор тактовой частоты', 'Сравнение текущей и эталонной частоты', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.11 Таблица А.11 (А.1.3)'),
(49, 10, 'Контроль джиттера', 'Измерение и контроль временных искажений', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.11 Таблица А.11 (А.2.1)'),
(50, 10, 'Диагностика синхронизации', 'Проверка синхронности работы устройств', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.11 Таблица А.11 (А.2.2)'),

-- Методы для устройств связи (категория 11)
(51, 11, 'Мониторинг канала связи', 'Непрерывный контроль состояния канала связи', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.12 Таблица А.12 (А.1.1)'),
(52, 11, 'Контроль ошибок передачи', 'Обнаружение и коррекция ошибок при передаче данных', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.12 Таблица А.12 (А.2.1)'),
(53, 11, 'Мониторинг задержки передачи', 'Измерение времени задержки при передаче данных', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.12 Таблица А.12 (А.2.2)'),
(54, 11, 'Проверка целостности сообщений', 'Верификация корректности переданных данных', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.12 Таблица А.12 (А.2.3)'),

-- Методы для датчиков (категория 12)
(55, 12, 'Мониторинг показаний датчика', 'Непрерывный контроль показаний датчика', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.13 Таблица А.13 (А.1.1)'),
(56, 12, 'Компаратор', 'Сравнение показаний с эталонным значением', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.13 Таблица А.13 (А.1.3)'),
(57, 12, 'Самокалибровка', 'Автоматическая калибровка датчика', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.13 Таблица А.13 (А.2.1)'),
(58, 12, 'Диагностика погрешности', 'Контроль точности измерений', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.13 Таблица А.13 (А.2.2)'),

-- Методы для исполнительных элементов (категория 13)
(59, 13, 'Мониторинг состояния', 'Непрерывный контроль состояния исполнительного элемента', 'LOW', 60.0, 'MEDIUM', 'LOW', 'А.14 Таблица А.14 (А.1.1)'),
(60, 13, 'Обратная связь', 'Контроль положения и состояния через обратную связь', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.14 Таблица А.14 (А.2.1)'),
(61, 13, 'Тестирование хода', 'Проверка полного цикла работы исполнительного механизма', 'MEDIUM', 90.0, 'HIGH', 'MEDIUM', 'А.14 Таблица А.14 (А.2.2)'),
(62, 13, 'Диагностика усилия', 'Контроль усилия, создаваемого исполнительным элементом', 'HIGH', 99.0, 'HIGH', 'HIGH', 'А.14 Таблица А.14 (А.2.3)'),

-- Методы для шины (категория 14)
(63, 14, 'Контроль целостности шины', 'Проверка целостности шины и обнаружение обрывов', 'HIGH', 99.0, 'HIGH', 'HIGH', 'ГОСТ Р МЭК 61508-2-2012 А.3'),
(64, 14, 'Мониторинг арбитража', 'Контроль приоритетов и арбитража доступа к шине', 'HIGH', 99.0, 'HIGH', 'HIGH', 'ГОСТ Р МЭК 61508-2-2012 А.3'),
(65, 14, 'Проверка четности адресов', 'Контроль корректности адресации на шине', 'HIGH', 99.0, 'HIGH', 'MEDIUM', 'ГОСТ Р МЭК 61508-2-2012 А.8'),
(66, 14, 'Контроль таймаутов', 'Обнаружение зависаний на шине', 'HIGH', 99.0, 'HIGH', 'HIGH', 'ГОСТ Р МЭК 61508-2-2012 А.9'),

-- Методы для процессора (категория 15)
(67, 15, 'Контроль потока команд', 'Мониторинг корректного выполнения инструкций', 'HIGH', 99.0, 'HIGH', 'HIGH', 'ГОСТ Р МЭК 61508-2-2012 А.4'),
(68, 15, 'Проверка регистров', 'Верификация целостности регистров процессора', 'HIGH', 99.0, 'HIGH', 'HIGH', 'ГОСТ Р МЭК 61508-2-2012 А.4'),
(69, 15, 'Контроль стека', 'Мониторинг переполнения и исчерпания стека', 'HIGH', 99.0, 'HIGH', 'HIGH', 'ГОСТ Р МЭК 61508-2-2012 А.4'),
(70, 15, 'Тестирование АЛУ', 'Проверка арифметико-логического устройства', 'HIGH', 99.0, 'HIGH', 'HIGH', 'ГОСТ Р МЭК 61508-2-2012 А.4');

-- Добавляем диагностические методы для категории "Шина" (ID=14)

-- Метод с НИЗКИМ уровнем покрытия
INSERT INTO diagnostic_methods (id, device_category_id, name, description, coverage_level, coverage_percent, effectiveness, implementation_complexity, gost_reference)
VALUES (71,
        14,
        'Онлайн-мониторинг активности шины',
        'Базовая проверка наличия тактового сигнала и обмена данными на шине без глубокого анализа. Позволяет обнаружить полный отказ (обрыв, короткое замыкание).',
        'LOW',
        60.0,
        'MEDIUM',
        'LOW',
        'ГОСТ Р МЭК 61508-2-2012 А.3 (А.1.1)');

-- Метод со СРЕДНИМ уровнем покрытия
INSERT INTO diagnostic_methods (id, device_category_id, name, description, coverage_level, coverage_percent, effectiveness, implementation_complexity, gost_reference)
VALUES (72,
        14,
        'Контроль целостности по избыточности',
        'Проверка передаваемых по шине данных с использованием бита четности или простого кода избыточности для обнаружения одиночных битовых ошибок.',
        'MEDIUM',
        90.0,
        'HIGH',
        'MEDIUM',
        'ГОСТ Р МЭК 61508-2-2012 А.8 (А.7.1, А.7.2)');

-- Создаем тестовый профиль
INSERT INTO profiles (id, name, description, architecture_type, test_interval_days, total_diagnostic_coverage, is_compliant, pfd_avg, pfd_max, sil_level) VALUES
(1, 'Тестовый профиль', 'Профиль для тестирования функциональности', 'ONE_OUT_OF_TWO', 30, 95.5, true, 0.0001, 0.001, 3);

-- Связываем устройства с тестовым профилем
INSERT INTO profile_devices (profile_id, device_id) VALUES
(1, 1), (1, 2), (1, 3), (1, 4), (1, 5);

-- Связываем диагностические методы с тестовым профилем
-- Используем только существующие методы и устройства
INSERT INTO profile_diagnostic_methods (profile_id, diagnostic_method_id, device_id, diagnostic_coverage, is_active) VALUES
-- Методы для устройства 1 (электромеханическое устройство)
(1, 1, 1, 60.0, true), 
(1, 2, 1, 90.0, true), 
(1, 3, 1, 99.0, true),
-- Методы для устройства 2 (цифровой вход/выход)
(1, 5, 2, 99.0, true), 
(1, 6, 2, 99.0, true),
-- Методы для устройства 3 (аналоговый вход/выход)
(1, 34, 3, 90.0, true), 
(1, 35, 3, 99.0, true),
-- Методы для устройства 4 (источник питания)
-- (1, 43, 4, 60.0, true),
-- (1, 44, 4, 90.0, true),
-- Методы для устройства 5 (общая шина)
(1, 5, 5, 60.0, true), 
(1, 6, 5, 99.0, true);

-- Включаем проверку внешних ключей обратно
SET REFERENTIAL_INTEGRITY TRUE;

-- Завершаем транзакцию
COMMIT;

-- Обновляем последовательности для автоматической генерации ID
ALTER SEQUENCE device_categories_seq RESTART WITH 14;
ALTER SEQUENCE devices_seq RESTART WITH 25;
ALTER SEQUENCE diagnostic_methods_seq RESTART WITH 63;
ALTER SEQUENCE profiles_seq RESTART WITH 2;
